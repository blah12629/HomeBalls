@using static HomeBallsEntryObtainedStatus
@using static HomeBallsEntryLegalityStatus
@inject IHomeBallsDataSource DataSource

@if (IsBallShown)
{
    @if (Cell.LegalityStatus == NotObtainable)
    {
        <td class="bg-opacity-50 cursor-pointer bg-dream-purple hover:bg-opacity-75" />
    }

    else if (Cell.LegalityStatus == ObtainableWithoutHiddenAbility)
    {
        <td class="bg-opacity-50 cursor-pointer bg-dream-dark hover:bg-opacity-75">
            @if (Cell.ObtainedStatus == ObtainedWithoutHiddenAbility ||
                Cell.ObtainedStatus == ObtainedWithHiddenAbility)
            {
                <BallSprite Ball="@Ball" />
            }
        </td>
    }

    else if (Cell.LegalityStatus == ObtainableWithHiddenAbility)
    {
        <td class="cursor-pointer hover:bg-dream-dark hover:bg-opacity-50">
            @if (Cell.ObtainedStatus == ObtainedWithoutHiddenAbility ||
                Cell.ObtainedStatus == ObtainedWithHiddenAbility)
            {
                <BallSprite Ball="@Ball" />
            }
        </td>
    }
}

@code {
    IHomeBallsEntryCell? _cell;

    [Parameter, EditorRequired]
    public IHomeBallsEntryCell Cell { get => _cell!; init => _cell = value; }

    IHomeBallsItem Ball => DataSource.Items[Cell.BallId];

    Boolean IsBallShown => Ball.CategoryId == 39 || Ball.Id == 5 || Ball.Id > 456;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        Cell.PropertyChanged += OnCellPropertyChanged;
    }

    protected virtual void OnCellPropertyChanged(
        Object? sender,
        HomeBallsPropertyChangedEventArgs e)
    {
        if (Cell.LegalityStatus != NotObtainable) StateHasChanged();
    }
}